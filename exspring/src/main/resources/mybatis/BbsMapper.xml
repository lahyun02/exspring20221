<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace는 현재 파일에 정의된 SQL문 집합의 고유한 이름 -->
<!-- 보통은 SQL문을 실행할 Dao 인터페이스 이름으로 설정 -->
<mapper namespace="com.exam.exspring.bbs.BbsDao">

<!-- bbs게시판에서는 사용안하니까 지워도 됨 -->
<!-- com.exam.member.MemberVo 객체의  -->
	<resultMap type="BbsVo" id="bbsMap"> 
		<!-- resultMap의 type에도 typeAliases 별명으로 써도 되고 안써도 됨. -->
		<!-- PK컬럼은 result 태그 대신 id 태그를 사용. (result태그써도 기능에 큰 상관은없지만, 조인할때 등 id태그로 알려주면 좋음. -->
		<id property="bbsNo" column="BBS_NO" />
		<result property="bbsTitle" column="BBS_TITLE" />
		<result property="bbsContent" column="BBS_CONTENT" />
		<result property="bbsWriter" column="BBS_WRITER" />
		<result property="bbsRegDate" column="BBS_REG_DATE" />
		<result property="bbsCount" column="BBS_COUNT" />
	</resultMap>
	
<!-- SQL문 실행 결과 1개의 레코드를 담을 객체의 클래스명을 resultType 속성에 지정 -->
<!-- 줄 값이 있을 떈 (insert문) parameterType 속성 -->

<!-- 마이바티스는 기본적으로 resultType객체의 컬럼이름과 동일한 변수(속성, 필드)에 컬럼의 값을 저장 -->
<!-- 1. 컬럼이름이 변수이름과 같아지도록 select문 내에 alisa(별칭)을 붙여줌. sql문에서 as는 생략 가능.-->
<!-- 2. resultMap으로 어떤 컬럼의 값을 어떤 변수에 담을지 정의-->
<!-- 3. 스네이크 표기법을 낙타표기법으로 바꿔서 매핑해줌(mybatis-config.xml에서 설정)-->
  <select id="selectBbsList" resultType="BbsVo">  <!-- typeAliases를 선언해서 이렇게 짧게 줄여써도 됨. -->
    SELECT BBS_NO, BBS_TITLE, BBS_WRITER, BBS_REG_DATE 
    FROM BBS
    <where>
    <!-- test 안: 속성이름 그대로 사용. jsp처럼 empty사용x -->
	    <if test="searchWord != null and searchWord != ''">
	    	<choose>
	    		<when test="searchType == 'title'">
			    	BBS_TITLE LIKE '%' || #{searchWord} || '%'
	    		</when>
	    		<when test="searchType == 'content'">
			    	BBS_CONTENT LIKE '%' || #{searchWord} || '%'
	    		</when>
	    		<when test="searchType == 'total'">
			    	BBS_TITLE LIKE '%' || #{searchWord} || '%' 
	    		 		OR BBS_CONTENT LIKE '%' || #{searchWord} || '%'
	    		</when>
	    	</choose>
	    </if>
    </where>
    ORDER BY BBS_NO DESC
  </select>
  <!-- <where>태그 안에 내용이 있으면 들어가고 없으면 안들어감. -->
  
  <select id="selectBbs" parameterType="integer" resultType="com.exam.exspring.bbs.BbsVo"> 
    SELECT BBS_NO, BBS_TITLE, BBS_WRITER, BBS_CONTENT, BBS_REG_DATE FROM BBS WHERE BBS_NO = #{bbsNo}
  </select>
  <!-- 의미없게 명시할 경우: WHERE BBS_NO = #{value} (단일파라미터 변수명:아무거나ok) -->
  
   <insert id="insertBbs" parameterType="BbsVo">
  	INSERT INTO BBS 
	(BBS_NO, BBS_TITLE, BBS_CONTENT, BBS_WRITER, BBS_REG_DATE)
	VALUES (bbs_seq.NEXTVAL, #{bbsTitle}, #{bbsContent}, #{bbsWriter}, SYSDATE) 
  </insert>
  
  <update id="updateBbs" parameterType="com.exam.exspring.bbs.BbsVo">
  	UPDATE BBS 
	SET BBS_TITLE=#{bbsTitle}, BBS_CONTENT=#{bbsContent}
	WHERE BBS_NO=#{bbsNo}
  </update>
  
  <delete id="delBbs" parameterType="integer">
  	DELETE FROM BBS WHERE BBS_NO=#{bbsNo}
  </delete>

  
<!-- mybatis에 parameterType은 생략 가능. 에러 안남. 명시적으로 써주는 것 권장.-->

</mapper>

